<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro de remédios</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
    />
    <link rel="stylesheet" href="/../css/styles-index.css" />
    <link rel="stylesheet" href="/../css/styles-meus-remedios.css" />
    <link rel="stylesheet" href="/../css/styles-remedios.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0"
    />
  </head>

  <body>
    <header>
      <span class="material-symbols-outlined seta"
        ><a href="./cadastro-remedios.html">arrow_back</a></span
      >
      <nav class="navbar">
        <div class="logo">
          <img src="../../img/logo.png" alt="Logo 60+ Tech" />
        </div>
        <span class="detalhe-01"></span>
        <span class="detalhe-02"></span>
        <ul class="nav-menu">
          <li class="nav-item">
            <a href="../index.html" class="nav-link">Home</a>
          </li>
          <li class="nav-item">
            <a href="../sobre-nos.html" class="nav-link">Sobre nós</a>
          </li>
          <li class="nav-item">
            <a href="../usuario/perfil.html" class="nav-link">Meu Perfil</a>
          </li>
          <li class="nav-item">
            <a
              href="../registration page/registration page.html"
              class="other-1"
              class="nav-link"
              >Registrar-se</a
            >
          </li>
        </ul>
        <div class="hamburger">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </div>
      </nav>
    </header>
    <main>
      <div class="cards">
        <div class="box conteudo">
          <p
            style="
              font-size: xx-large;
              padding-bottom: 20px;
              text-align: center;
            "
          >
            Meus medicamentos
          </p>
          <div class="labels">
            <table>
              <thead>
                <tr>
                  <th><div class="label">NOME :</div></th>
                  <th><div class="label">QUANTIDADE :</div></th>
                  <th><div class="label">DATA :</div></th>
                  <th><div class="label">HORÁRIO :</div></th>
                  <th><div class="label">OBSERVAÇÕES:</div></th>
                </tr>
              </thead>
              <tbody id="medicamentos" style="text-align: center">
                <!-- Linhas da tabela serão inseridas aqui -->
              </tbody>
            </table>
          </div>
          <div class="form-buttons">
            <button class="btn remedios">
              <a
                style="text-decoration: none; color: black"
                href="./cadastro-remedios.html"
                >Adicionar Remedio</a
              >
            </button>
          </div>
        </div>
      </div>
    </main>
    <footer>
      <nav>
        <ul>
          <li>
            <a class="contato" href=""
              ><span class="material-icons orange">phone</span> Contato:
            </a>
          </li>
          <li>
            <a class="email" href=""
              ><span class="material-symbols-outlined mail">mail</span>
              60+tech@gmail.com</a
            >
          </li>
          <li>
            <a
              class="githubLink"
              href="https://github.com/ICEI-PUC-Minas-PMV-SI/pmv-si-2024-1-pe1-t5-60tech"
              target="_blank"
            >
              <i
                class="fa fa-github"
                style="font-size: 28px; color: #ecae2a"
              ></i>
              GitHub do projeto</a
            >
          </li>
        </ul>
      </nav>
      <p class="copyright">
        2024 60+ TECH - Todos Direitos Reservados
        <span class="material-icons md-18 orange">copyright</span>
      </p>
    </footer>
    <script src="menu.js"></script>
    <script src="./medicamentos.js"></script>
    <script>
      function exibe() {
        // Popula a tabela com os registros do banco de dados
        fetch(apiUrl)
          .then((response) => {
            console.log("Resposta da API:", response);
            if (!response.ok) {
              throw new Error("Erro ao buscar dados da API");
            }
            return response.json();
          })
          .then((data) => {
            // Limpa o conteúdo atual da tabela
            document.getElementById("medicamentos").innerHTML = "";

            // Obtém o usuário corrente
            const usuarioCorrente = JSON.parse(
              sessionStorage.getItem("usuarioCorrente"),
            );
            // Filtra os medicamentos com base no userId
            const medicamentosDoUsuario = data.filter(
              (medicamento) => medicamento.user_id === usuarioCorrente.id,
            );

            // Itera sobre os dados dos medicamentos do usuário e cria linhas na tabela para cada um
            medicamentosDoUsuario.forEach((medicamento) => {
              const tr = document.createElement("tr");
              tr.innerHTML = `
                  <td>${medicamento.nome}</td>
                  <td>${medicamento.quantidade}</td>
                  <td>${medicamento.date}</td>
                  <td>${medicamento.horario}</td>
                  <td>${medicamento.observacao || " - "}</td> <!-- Verifica se observacoes está definido, se não, usa uma string vazia -->
                `;
              document.getElementById("medicamentos").appendChild(tr);
            });
          })
          .catch((error) => {
            console.error(
              "Erro ao ler medicamentos via API JSONServer:",
              error,
            );
            alert("Erro ao buscar dados dos medicamentos");
          });
      }

      // Função para inicializar a página
      function initPage() {
        // Verifica se o usuário está logado
        const usuarioCorrente = JSON.parse(
          sessionStorage.getItem("usuarioCorrente"),
        );
        if (!usuarioCorrente) {
          alert("Você precisa estar logado para acessar essa página");
          window.location.href = "../login-page/login-page.html";
          return; // Encerra a execução da função se o usuário não estiver logado
        }

        // Exibe os medicamentos na tabela
        exibe();
        //configura a funcao de disparar o email pelo clicl do botao
        //const sendMailButton = document.getElementById("sendMail");
        //sendMailButton.addEventListener("click", sendMail);
      }

      // Associa a função initPage ao evento de carga da página
      window.addEventListener("load", initPage);
    </script>
  </body>
</html>
